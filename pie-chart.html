<!DOCTYPE html>
<html>

<head>
  <title>DSCI 554 Lab Pie Chart</title>

  <link href="css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css">

  <link href="css/bootstrap-icons.css" rel="stylesheet">

  <link rel="stylesheet" href="css/github-dark-dimmed.min.css">
  <script src="js/highlight.min.js"></script>

  <script src="js/highlightjs-copy.min.js"></script>
  <link rel="stylesheet" href="css/highlightjs-copy.min.css" />

  <script>
    hljs.highlightAll();
    hljs.addPlugin(new CopyButtonPlugin());
  </script>

  <script src="js/d3.min.js"></script>

  <style>
    .arc text {
      font: 10px sans-serif;
      text-anchor: middle;
    }

    .arc path {
      stroke: #fff;
    }

    .legend-item {
      display: flex;
      align-items: center;
      margin-bottom: 10px;
    }

    .legend-color {
      width: 20px;
      height: 20px;
      margin-right: 10px;
      border: 1px solid #000; /* You can adjust the border properties */
    }
  </style>
</head>

<body>
  <div style="display: flex;">
    <div id="legend" style="margin-right: 20px;"></div>
    <svg id="pie-chart" width="600" height="500"></svg>
  </div>

  <script>
    d3.json('data/population.json', d => {
      d.Year = +d.Year;
      d.Population = +d.Population;

      return d;
    }).then(data => {
      // data = data.filter(() => data.type == "A");
      var filteredData = data.filter((d) => d.Year === 2020);

      var svg = d3.select('#pie-chart'),
        width = +svg.attr('width'),
        height = +svg.attr('height'),
        radius = Math.min(width, height) / 2,
        g = svg.append('g')
          .attr('transform', 'translate(' + width / 2 + ',' + height / 2 + ')');

      // var color = d3.scaleOrdinal(['#98abc5', '#8a89a6', '#7b6888', '#6b486b']);

      // Create D3 color scale
      var countries = filteredData.map(d => d.Country);
      var color = d3.scaleOrdinal()
        .domain(countries)
        .range(d3.schemeTableau10);

      var pie = d3.pie()
        .value(d => d.Population)
        .sort(null)
        .sortValues(d3.descending);

      var path = d3.arc()
        .outerRadius(radius)
        .innerRadius(0);  //.innerRadius(150);  //make a donut chart by changing the inner radius

      var arc = g.selectAll('.arc')
        .data(pie(filteredData))
        .enter()
        .append('g')
        .attr('class', 'arc');

      arc.append('path')
        .attr('d', path)
        .attr('fill', d => color(d.data.Country));

      var legend = d3.select('#legend')
        .selectAll('div')
        .data(filteredData)
        .enter()
        .append('div')
        .attr('class', 'legend-item');

      legend.append('div')
        .attr('class', 'legend-color')
        .style('background-color', d => color(d.Country));

      legend.append('div')
        .attr('class', 'legend-label')
        .text(d => d.Country);
    });
  </script>
</body>

</html>